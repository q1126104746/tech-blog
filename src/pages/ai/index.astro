---
import type { GetStaticPaths } from "astro";
import Pagination from "@/components/control/Pagination.astro";
import PostPage from "@/components/PostPage.astro";
import { PAGE_SIZE } from "@/constants/constants";
import MainGridLayout from "@/layouts/MainGridLayout.astro";
import { getSortedPosts } from "@/utils/content-utils";

// å¯¼å…¥å†…å®¹é›†åˆAPIç”¨äºç­›é€‰
import { getCollection } from 'astro:content';

export const getStaticPaths = (async ({ paginate }) => {
    // 1. è·å–æ‰€æœ‰æ–‡ç« 
    const allBlogPosts = await getSortedPosts();
    
    // 2. ç­›é€‰å‡ºAIç›¸å…³çš„æ–‡ç« ï¼ˆæŒ‰åˆ†ç±»æˆ–æ ‡ç­¾ï¼‰
    const aiPosts = allBlogPosts.filter(post => {
        // æ–¹å¼Aï¼šæŒ‰åˆ†ç±»ç­›é€‰ï¼ˆæ¨èï¼‰
        return post.data.category === 'ai';
        // æ–¹å¼Bï¼šæŒ‰æ ‡ç­¾ç­›é€‰ï¼ˆå¦‚æœæ–‡ç« æœ‰AIæ ‡ç­¾ï¼‰
        // return post.data.tags && post.data.tags.includes('AI');
    });
    
    // 3. å¯¹ç­›é€‰åçš„æ–‡ç« è¿›è¡Œåˆ†é¡µï¼ˆå¦‚æœaiPostsä¸ºç©ºæ•°ç»„ï¼Œè¿™é‡Œä¼šäº§ç”Ÿé—®é¢˜ï¼‰
    return paginate(aiPosts, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

const { page } = Astro.props;

// ğŸ”½ ä¿®å¤ï¼šæ£€æŸ¥ page æ˜¯å¦å­˜åœ¨ ğŸ”½
const len = page ? page.data.length : 0;
---

<MainGridLayout>
    <!-- å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ æ ç›®ä¸“å±çš„æ ‡é¢˜ -->
    <div class="mb-6">
        <h1 class="text-3xl font-bold">AIæ”»ç•¥ä¸“æ </h1>
        <p class="text-gray-600 dark:text-gray-400">è¿™é‡Œæ±‡é›†æ‰€æœ‰AIå·¥å…·ä½¿ç”¨æ•™ç¨‹å’ŒæŠ€å·§</p>
    </div>
    
    <!-- ğŸ”½ ä¿®å¤ï¼šåªæœ‰ page å­˜åœ¨æ—¶æ‰æ¸²æŸ“æ–‡ç« åˆ—è¡¨ ğŸ”½ -->
    {
        page ? (
            <>
                <PostPage page={page}></PostPage>
                <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${len*50}ms)`}></Pagination>
            </>
        ) : (
            <div class="text-center py-12">
                <p class="text-gray-500 dark:text-gray-400">æš‚æ— AIç›¸å…³æ–‡ç« ï¼Œå¿«å»å†™ä¸€ç¯‡å§ï¼</p>
            </div>
        )
    }
</MainGridLayout>