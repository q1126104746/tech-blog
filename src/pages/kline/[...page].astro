---
import type { GetStaticPaths } from "astro";
import Pagination from "@/components/control/Pagination.astro";
import PostPage from "@/components/PostPage.astro";
import { PAGE_SIZE } from "@/constants/constants";
import MainGridLayout from "@/layouts/MainGridLayout.astro";
import { getSortedPosts } from "@/utils/content-utils";

export const getStaticPaths = (async ({ paginate }) => {
    const allBlogPosts = await getSortedPosts();
    
    // 筛选K线/技术分析相关文章
    const klinePosts = allBlogPosts.filter(post => {
        // 按分类筛选
        if (post.data.category === 'kline') return true;
        
        // 按标签关键词筛选
        const klineKeywords = ['k线', '技术分析', '图表', '指标', '形态', '支撑', '阻力', '趋势'];
        const tags = post.data.tags || [];
        const title = (post.data.title || '').toLowerCase();
        
        return klineKeywords.some(keyword => {
            const keywordLower = keyword.toLowerCase();
            return title.includes(keywordLower) ||
                   tags.some(tag => String(tag).toLowerCase().includes(keywordLower));
        });
    });
    
    return paginate(klinePosts, { pageSize: PAGE_SIZE });
}) satisfies GetStaticPaths;

const { page } = Astro.props;
const len = page ? page.data.length : 0;

// 显示标签（可按需修改）
const DISPLAY_TAGS = ['K线形态', '技术指标', '支撑阻力', '趋势分析', '图表分析'];
---

<MainGridLayout>
    <div class="mb-8">
        <h1 class="text-3xl font-bold mb-2">K线技术专栏</h1>
        <p class="text-gray-600 dark:text-gray-400 mb-4">
            K线形态解析、技术指标应用与实战图表分析
        </p>
        
        <!-- 标签展示（紫色主题） -->
        <div class="flex flex-wrap gap-2">
            {DISPLAY_TAGS.map(tag => (
                <span 
                    class="px-3 py-1 bg-purple-100 dark:bg-purple-900 text-purple-800 dark:text-purple-200 text-sm rounded-full transition-colors hover:bg-purple-200 dark:hover:bg-purple-800"
                >
                    #{tag}
                </span>
            ))}
        </div>
    </div>
    
    {
        page ? (
            <>
                <PostPage page={page}></PostPage>
                <Pagination class="mx-auto onload-animation" page={page} style={`animation-delay: calc(var(--content-delay) + ${len*50}ms)`}></Pagination>
            </>
        ) : (
            <div class="text-center py-12">
                <p class="text-gray-500 dark:text-gray-400">暂无K线技术相关文章</p>
            </div>
        )
    }
</MainGridLayout>